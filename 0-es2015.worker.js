!function(t){var e={};function a(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,(function(e){return t[e]}).bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s="QKe9")}({QKe9:function(t,e){let a=[],n=[{number:0,hash:[2,9,8,3,0,0,0,0,10,2,0,0,10,10,1,0,10,0,0,0,0,10,8,0,3,0,0,0,0,6,10,2,0,0,0,0,0,4,10,3,0,0,0,0,0,4,10,3,3,0,0,0,0,5,10,2,9,0,0,0,0,9,9,0,10,3,0,0,10,10,1,0,3,9,10,3,0,0,0,0],count:10},{number:1,hash:[51,47,37,22,0,0,0,0,54,25,46,29,0,0,0,0,0,6,45,43,0,0,0,0,0,1,45,43,0,0,0,0,0,1,45,43,0,0,0,0,0,2,45,43,0,0,0,0,0,2,45,43,0,0,0,0,0,1,45,43,0,0,0,0,3,6,48,44,0,0,0,0,16,1,1,0,0,0,0,0],count:60},{number:2,hash:[35,33,14,2,1,1,0,0,9,0,0,3,33,33,3,0,0,0,0,0,24,36,13,0,0,0,0,0,23,36,14,0,0,0,0,0,29,36,3,0,0,0,0,14,36,12,1,0,0,4,28,36,4,1,0,0,15,32,31,5,0,0,0,0,36,24,3,0,1,2,0,0,9,0,1,1,0,1,1,0],count:36},{number:3,hash:[31,28,14,6,0,0,0,0,27,1,0,0,29,30,6,0,0,0,0,0,13,31,16,0,0,0,0,0,23,29,8,0,3,25,32,10,6,0,0,0,2,19,25,14,23,11,1,0,0,0,0,0,5,28,29,2,0,0,0,0,1,23,31,5,1,0,0,1,17,32,25,2,32,21,6,2,1,0,0,0],count:32},{number:4,hash:[0,0,0,12,30,17,0,0,0,0,16,30,15,0,0,0,0,2,30,26,0,13,0,0,1,30,29,0,18,30,0,0,27,30,1,0,24,30,0,0,30,4,0,0,24,30,0,0,12,0,0,2,11,9,0,0,3,0,0,3,29,27,0,0,0,0,0,0,22,30,0,0,0,0,0,0,22,30,0,0],count:30},{number:5,hash:[34,11,2,0,0,0,0,0,33,1,0,0,1,1,0,0,32,1,0,0,0,0,0,0,31,0,1,5,0,0,0,0,33,0,0,0,21,18,1,0,10,0,0,0,20,35,33,2,0,0,0,0,0,25,35,6,0,0,0,0,2,29,34,4,0,0,0,3,30,36,23,0,36,25,8,1,3,0,0,0],count:36},{number:6,hash:[3,10,13,8,2,0,0,0,13,9,0,0,1,9,7,0,13,0,0,0,0,0,0,0,6,0,0,3,1,0,0,0,0,0,6,3,2,3,0,0,0,0,0,0,6,13,10,0,2,0,0,0,0,9,13,1,10,0,0,0,0,10,13,1,13,3,0,0,5,13,9,0,7,11,12,5,0,0,0,0],count:13},{number:7,hash:[5,1,1,0,0,0,0,0,2,0,0,0,12,19,8,0,0,0,0,1,18,18,1,0,0,0,0,4,19,0,0,0,0,0,2,19,7,0,0,0,0,0,8,19,0,0,0,0,0,1,18,17,0,0,0,0,0,1,19,14,0,0,0,0,0,2,19,12,0,0,0,0,0,3,19,10,0,0,0,0],count:19},{number:8,hash:[12,18,18,8,1,0,0,0,19,3,0,0,13,19,8,0,16,0,0,0,3,17,17,1,19,1,0,0,3,19,17,0,13,19,8,0,3,8,0,0,19,12,0,5,16,6,0,0,9,0,0,0,5,18,19,5,1,0,0,0,0,6,19,11,13,0,0,0,6,18,17,4,17,19,13,5,3,3,0,0],count:19},{number:9,hash:[14,17,11,2,1,0,0,0,13,0,0,0,14,16,4,0,1,0,0,0,4,14,16,1,0,0,0,0,0,10,17,3,8,0,0,0,8,16,16,0,17,8,1,0,7,2,10,2,0,3,3,0,0,11,17,2,0,0,0,0,4,16,15,0,12,2,0,1,17,17,1,0,17,10,5,3,0,0,0,0],count:17}];for(let g of n)g.hash instanceof Array&&(g.hash=g.hash.map(t=>t/g.count));for(let g of a)g.hash instanceof Array&&(g.hash=g.hash.map(t=>t/g.count));let o,h,s=[{R:[225,255],G:[175,205],B:[0,10]},{R:[208,222],G:[185,205],B:[208,222]},{R:[0,5],G:[170,190],B:[240,255]},{R:[215,245],G:[225,240],B:[50,60]},{R:[0,10],G:[0,4],B:[0,4]},{R:[200,220],G:[165,179],B:[0,4]}],r=[[]],l=[[]],d=[],u=[],c=[];addEventListener("message",t=>{switch(t.data.method){case"LoadHashData":a=t.data.Data;for(let t of a)t.hash instanceof Array&&(t.hash=t.hash.map(e=>e/t.count));break;case"ImageDataLoad":postMessage({text:"\u56fe\u50cf\u6570\u636e\u9884\u5904\u7406 - \u8fb9\u754c\u8bc6\u522b",progress:.1}),o=new Uint16Array(t.data.data.width),h=new Uint16Array(t.data.data.height),r=[[]],l=[[]],d=[],c=[],u=[],function(t){for(let e=0;e<t.data.length;e+=4){const a=t.data[e],n=t.data[e+1],r=t.data[e+2],l=Math.floor(e/4)%t.width,d=Math.floor(Math.floor(e/4)/t.width);s.some(t=>t.R[0]<=a&&t.R[1]>=a&&t.G[0]<=n&&t.G[1]>=n&&t.B[0]<=r&&t.B[1]>=r)&&(o[l]++,h[d]++)}}(t.data.data),postMessage({method:"status",text:"\u5206\u6790\u56fe\u50cf\u8fb9\u754c",progress:.2}),function(){for(let a=0,n=0,h=0;a<o.length;a++)o[a]>8?(0==r[r.length-1].length&&(r[r.length-1][0]=a,n=0),h=a,n=0):o[a]>2&&o[a]<=8?(o[a-1]>8||o[a+1]>8)&&(0==r[r.length-1].length&&(r[r.length-1][0]=a,n=0),h=a,n=0):1==r[r.length-1].length&&n>=10?(r[r.length-1][1]=h,r.push([]),n=0):1==r[r.length-1].length&&n++;1==r[r.length-1].length&&Math.abs(o.length-1-r[r.length-1][0]-(r[r.length-2][1]-r[r.length-2][0]))<5?r[r.length-1][1]=o.length-1:r.pop();let t=[];for(let a=0;a<r.length;a++)t.push(r[a][1]-r[a][0]);let e=Math.round(t.reduce((t,e)=>t+e)/t.length);for(let a=0;a<r.length;a++)r[a][1]-r[a][0]<50?(r.splice(a,1),a--):Math.abs(r[a][1]-r[a][0]-e)>20&&(r[a][1]=r[a][0]+Math.max(...t));for(let a=0,n=0,o=0;a<h.length;a++)h[a]>8?(0==l[l.length-1].length&&(l[l.length-1][0]=a,n=0),o=a):1==l[l.length-1].length&&n>=10?(l[l.length-1][1]=o,l.push([]),n=0):1==l[l.length-1].length&&n++;1==l[l.length-1].length?l[l.length-1][1]=h.length-1:l.pop();for(let a=0;a<l.length;a++)l[a][1]-l[a][0]<50&&(l.splice(a,1),a--)}(),postMessage({method:"status",text:"\u4e3b\u7ebf\u7a0b\u5207\u56fe(\u9875\u9762\u53ef\u80fd\u6682\u65f6\u5361\u6b7b)",progress:.35}),postMessage({method:"clipImage",XBound:r,YBound:l});break;case"calcDhash":if(void 0!==t.data.index&&0!==c.length){let e=c[t.data.index];const n=a.map(t=>{let a=0;for(let o=0;o<e.length;o++)a+="1"==e[o]?t.hash[o]:1-t.hash[o];a/=144;let n={id:t.id,hash:t.hash,confidence:a,count:t.count};return t.name&&(n.name=t.name),n}).sort((t,e)=>e.confidence-t.confidence);n[0].confidence<=.75&&n.unshift({id:"0000",hash:"",count:0,confidence:1}),d[t.data.index]=n}else d=t.data.ImageDatas.map(t=>{let e="";for(let a=0;a<t.data.length;a+=4)Math.floor(a/4)%t.width!=0&&(Math.floor((t.data[a-4]+t.data[a-3]+t.data[a-2])/3)>Math.floor((t.data[a]+t.data[a+1]+t.data[a+2])/3)?e+=1:e+=0);return e}),c=[...d],postMessage({method:"status",text:"\u6b63\u5728\u5224\u65ad\u56fe\u50cf\u5bf9\u5e94\u7684\u7269\u54c1",progress:.45}),d=d.map(t=>{const e=a.map(e=>{let a=0;for(let o=0;o<t.length;o++)a+="1"==t[o]?e.hash[o]:1-e.hash[o];a/=144;let n={id:e.id,hash:e.hash,confidence:a,count:e.count};return e.name&&(n.name=e.name),n}).sort((t,e)=>e.confidence-t.confidence);return e[0].confidence<=.75&&e.unshift({id:"0000",hash:"",count:0,confidence:1}),e}),postMessage({method:"status",text:"\u4e3b\u7ebf\u7a0b\u5207\u5272\u6570\u5b57(\u9875\u9762\u53ef\u80fd\u6682\u65f6\u5361\u6b7b)",progress:.57}),postMessage({method:"getNumberData"});break;case"getItemCount":postMessage({method:"status",text:"\u6b63\u5728\u8bc6\u522b\u7269\u54c1\u6570\u91cf",progress:.6}),u=t.data.ImageDatas.map(t=>t.map(t=>{let e="";for(let a=0;a<t.data.length;a+=4)Math.floor(a/4)%t.width!=0&&(Math.floor((t.data[a-4]+t.data[a-3]+t.data[a-2])/3)>Math.floor((t.data[a]+t.data[a+1]+t.data[a+2])/3)?e+=1:e+=0);return e}));let e=u.map(t=>Number(t.map(t=>{let e=n.map(e=>{let a=0;for(let n=0;n<t.length;n++)a+="1"==t[n]?e.hash[n]:1-e.hash[n];return a/=80,e.confidence=a,e}).sort((t,e)=>e.confidence-t.confidence);return e[0].confidence>.785?e[0].number:null}).join("")));postMessage({method:"status",text:"\u8bc6\u522b\u5b8c\u6210\uff0c\u70b9\u51fb\u4e0b\u65b9\u7269\u54c1\u53ef\u4ee5\u8fdb\u884c\u4fee\u6539\u3002",progress:1}),postMessage({method:"DetectResult",NumberResult:e,Items:d});break;case"getItemHashs":postMessage({method:"SingleItemHash",Item:d[t.data.index],OriginHash:c[t.data.index]})}})}});